scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
ggsci::scale_fill_jco() +
labs(
x = 'Stratum',
y = 'Relative %'
)
data_2013 = tab3_pick_data(2013, type) %>% filter(type != 'None' & stratum != "MPA") %>% calculate_area_wTrash()
data_2018 = tab3_pick_data(2018, type) %>% filter(type != 'None' & stratum != "MPA") %>% calculate_area_wTrash()
bind_rows(
tb_2013 %>% mutate(year = 2013),
tb_2018 %>% mutate(year = 2018)
) %>%
mutate(year = as.factor(year)) %>%
ggplot(aes(x = stratum, y = p_area_trash, fill = stratum)) +
geom_col() +
geom_text(aes(label = p_label), position = position_dodge(0.9), vjust = -1) +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
ggsci::scale_fill_jco() +
labs(
x = 'Stratum',
y = 'Relative %'
)
tb_2013 = tab3_pick_data(2013, type) %>% filter(type != 'None' & stratum != "MPA") %>% calculate_area_wTrash()
tb_2018 = tab3_pick_data(2018, type) %>% filter(type != 'None' & stratum != "MPA") %>% calculate_area_wTrash()
bind_rows(
tb_2013 %>% mutate(year = 2013),
tb_2018 %>% mutate(year = 2018)
) %>%
mutate(year = as.factor(year)) %>%
ggplot(aes(x = stratum, y = p_area_trash, fill = stratum)) +
geom_col() +
geom_text(aes(label = p_label), position = position_dodge(0.9), vjust = -1) +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
ggsci::scale_fill_jco() +
labs(
x = 'Stratum',
y = 'Relative %'
)
bind_rows(
tb_2013 %>% mutate(year = 2013),
tb_2018 %>% mutate(year = 2018)
) %>%
mutate(year = as.factor(year)) %>%
ggplot(aes(x = stratum, y = p_area_trash, fill = year, group = year)) +
geom_col(position = 'dodge') +
geom_text(aes(label = p_label), position = position_dodge(0.9), vjust = -1, size = 3) +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
ggsci::scale_fill_jco() +
labs(
x = 'Stratum',
y = 'Relative Percent Trash Area',
title = 'Percentage of Area with Trash',
caption = 'The percentages of area that we can find trash in 2018, in general,
are higher compared to 2013 especially in Bays and Mid Shelf area'
)
View(tb_2013)
View(tb_2018)
calculate_area_wTrash = function(data){
percent_trash_area =
data %>%
group_by(stationid, stratum) %>%
summarise(
total_count = sum(count),
area = sum(area_weight)
) %>%
mutate(trash_present = ifelse(total_count == 0, 0, 1)) %>%
group_by(stratum) %>%
summarise(
total_area = sum(area),
area_no_trash = sum(area[trash_present == 0]),
area_with_trash = sum(area[trash_present == 1])
)
p_area =
percent_trash_area %>%
add_row(stratum = 'Bight',
total_area = sum(percent_trash_area$total_area),
area_no_trash = sum(percent_trash_area$area_no_trash),
area_with_trash = sum(percent_trash_area$area_with_trash)
) %>%
mutate(
stratum = if_else(stratum == 'Bay', 'Bays', stratum),
p_area_trash = area_with_trash/total_area,
p_label = scales::percent(p_area_trash),
stratum = factor(stratum, levels = c('Bays', 'Inner Shelf', 'Mid Shelf',
'Outer Shelf', 'Upper Slope', 'MPA', 'Bight')))
return(p_area)
}
tab3_pick_data <- function(year, type){
new_names = c("stationid","stratum","region","area_weight","type","count")
if (year == 2018 & type == "Ocean"){
read.csv("data/Ocean/2018_debris_counts_in_details.csv") %>%
filter(abandoned == "No") %>%
select(stationid, final_stratum, region, area_weight, debris_type, debriscount) %>%
set_colnames(new_names) %>%
mutate(type = stringr::str_to_title(type)) %>%
mutate(count = ifelse(count < 0, 0, count))
} else if (year == 2018 & type == "River") {
read.csv("data/River/2018_river_debris_count.csv") %>%
select(stationid, stratum, county, area_weight, debriscategory, total_count) %>%
set_colnames(new_names) %>%
mutate(
stratum = as.character(stratum),
stratum = ifelse(stratum == 'Ag', 'Agriculture', stratum),
type = stringr::str_to_title(type)
) %>%
select(new_names) %>%
mutate(type = stringr::str_to_title(type)) %>%
mutate(count = ifelse(count < 0, 0, count))
} else if (year == 2013 & type == "Ocean") {
read.csv("data/Ocean/2013_ocean_debris_count.csv") %>%
select(stationid, stratum, region, areaweight, debriscategory, count) %>%
mutate(region = str_to_title(region)) %>%
set_colnames(new_names) %>%
mutate(type = stringr::str_to_title(type)) %>%
mutate(count = ifelse(count < 0, 0, count))
} else if (year == 2013 & type == "River") {
read.csv("data/River/2013_river_debris_count.csv") %>%
select(-c(sample_date,latitude,longitude,smcshed,location,totalcount)) %>%
melt(id.vars = c("stationid","stratum","area_weight","county"),
value.name = "count") %>%
mutate(type = str_remove(variable, "total"),
region = county) %>%
select(new_names) %>%
mutate(
stratum = as.character(stratum),
stratum = if_else(stratum == 'Ag', 'Agriculture', stratum),
region = str_to_title(region),
type = stringr::str_to_title(type)) %>%
mutate(count = ifelse(count < 0, 0, count))
} else {
NULL
}
}
calculate_area_wTrash = function(data){
percent_trash_area =
data %>%
group_by(stationid, stratum) %>%
summarise(
total_count = sum(count),
area = sum(area_weight)
) %>%
mutate(trash_present = ifelse(total_count == 0, 0, 1)) %>%
group_by(stratum) %>%
summarise(
total_area = sum(area),
area_no_trash = sum(area[trash_present == 0]),
area_with_trash = sum(area[trash_present == 1])
)
p_area =
percent_trash_area %>%
add_row(stratum = 'Bight',
total_area = sum(percent_trash_area$total_area),
area_no_trash = sum(percent_trash_area$area_no_trash),
area_with_trash = sum(percent_trash_area$area_with_trash)
) %>%
mutate(
stratum = if_else(stratum == 'Bay', 'Bays', stratum),
p_area_trash = area_with_trash/total_area,
p_label = scales::percent(p_area_trash),
stratum = factor(stratum, levels = c('Bays', 'Inner Shelf', 'Mid Shelf',
'Outer Shelf', 'Upper Slope', 'MPA', 'Bight')))
return(p_area)
}
tab3_percent_wTrash_plotter <- function(year, type){
tab3_pick_data(year, type) %>%
calculate_area_wTrash() %>%
filter(stratum != 'MPA') %>%
ggplot(aes(x = stratum, y = p_area_trash, fill = stratum)) +
geom_col() +
geom_text(aes(label = p_label), position = position_dodge(0.9), vjust = -1) +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
ggsci::scale_fill_jco() +
labs(
x = 'Stratum',
y = 'Relative %'
)
}
tb_2013 = tab3_pick_data(2013, type) %>% filter(type != 'None' & stratum != "MPA") %>% calculate_area_wTrash()
View(tb_2013)
type
tb_2013 = tab3_pick_data(2013, type) %>% filter(type != 'None' & stratum != "MPA") %>% calculate_area_wTrash()
tb_2013 = tab3_pick_data(2013, type) %>% filter(stratum != "MPA") %>% calculate_area_wTrash()
View(tb_2013)
tb_2018 = tab3_pick_data(2018, type) %>% filter(stratum != "MPA") %>% calculate_area_wTrash()
bind_rows(
tb_2013 %>% mutate(year = 2013),
tb_2018 %>% mutate(year = 2018)
) %>%
mutate(year = as.factor(year)) %>%
ggplot(aes(x = stratum, y = p_area_trash, fill = year, group = year)) +
geom_col(position = 'dodge') +
geom_text(aes(label = p_label), position = position_dodge(0.9), vjust = -1, size = 3) +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
ggsci::scale_fill_jco() +
labs(
x = 'Stratum',
y = 'Relative Percent Trash Area',
title = 'Percentage of Area with Trash',
caption = 'The percentages of area that we can find trash in 2018, in general,
are higher compared to 2013 especially in Bays and Mid Shelf area'
)
bind_rows(
tb_2013 %>% mutate(year = 2013),
tb_2018 %>% mutate(year = 2018)
) %>%
mutate(year = as.factor(year)) %>%
ggplot(aes(x = stratum, y = p_area_trash, fill = year, group = year)) +
geom_col(position = 'dodge') +
geom_text(aes(label = p_label), position = position_dodge(0.9), vjust = -1, size = 3) +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
ggsci::scale_fill_jco() +
labs(
x = 'Stratum',
y = 'Relative Percent Trash Area',
caption = 'The percentages of area that we can find trash in 2018, in general,
are higher compared to 2013 especially in Bays and Mid Shelf area'
)
bind_rows(
tb_2013 %>% mutate(year = 2013),
tb_2018 %>% mutate(year = 2018)
) %>%
mutate(year = as.factor(year)) %>%
ggplot(aes(x = stratum, y = p_area_trash, fill = year, group = year)) +
geom_col(position = 'dodge') +
geom_text(aes(label = p_label), position = position_dodge(0.9), vjust = -1, size = 3) +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
ggsci::scale_fill_jco() +
labs(
x = 'Stratum',
y = 'Relative Percent Trash Area'
)
tab3_compare_area_wTrash_plotter <- function(type){
tb_2013 = tab3_pick_data(2013, type) %>% filter(stratum != "MPA") %>% calculate_area_wTrash()
tb_2018 = tab3_pick_data(2018, type) %>% filter(stratum != "MPA") %>% calculate_area_wTrash()
bind_rows(
tb_2013 %>% mutate(year = 2013),
tb_2018 %>% mutate(year = 2018)
) %>%
mutate(year = as.factor(year)) %>%
ggplot(aes(x = stratum, y = p_area_trash, fill = year, group = year)) +
geom_col(position = 'dodge') +
geom_text(aes(label = p_label), position = position_dodge(0.9), vjust = -1, size = 3) +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
ggsci::scale_fill_jco() +
labs(
x = 'Stratum',
y = 'Relative Percent Trash Area'
)
return(plot)
}
runApp()
tab3_compare_area_wTrash_plotter <- function(type){
tb_2013 = tab3_pick_data(2013, type) %>% filter(stratum != "MPA") %>% calculate_area_wTrash()
tb_2018 = tab3_pick_data(2018, type) %>% filter(stratum != "MPA") %>% calculate_area_wTrash()
plot =
bind_rows(
tb_2013 %>% mutate(year = 2013),
tb_2018 %>% mutate(year = 2018)
) %>%
mutate(year = as.factor(year)) %>%
ggplot(aes(x = stratum, y = p_area_trash, fill = year, group = year)) +
geom_col(position = 'dodge') +
geom_text(aes(label = p_label), position = position_dodge(0.9), vjust = -1, size = 3) +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
ggsci::scale_fill_jco() +
labs(
x = 'Stratum',
y = 'Relative Percent Trash Area'
)
return(plot)
}
runApp()
runApp()
tb_2013 = tab3_pick_data(2013, type) %>% filter(stratum != "MPA") %>% calculate_area_wTrash()
tb_2018 = tab3_pick_data(2018, type) %>% filter(stratum != "MPA") %>% calculate_area_wTrash()
plot =
bind_rows(
tb_2013 %>% mutate(year = 2013),
tb_2018 %>% mutate(year = 2018)
) %>%
mutate(year = as.factor(year)) %>%
ggplot(aes(x = stratum, y = p_area_trash, fill = year, group = year)) +
geom_col(position = 'dodge') +
geom_text(aes(label = p_label), position = position_dodge(0.9), vjust = -1, size = 3) +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
ggsci::scale_fill_jco() +
labs(
x = 'Stratum',
y = 'Relative Percent Trash Area'
)
runApp()
runApp()
runApp()
tab3_compare_area_wTrash_plotter <- function(type){
tb_2013 = tab3_pick_data(2013, type) %>% filter(stratum != "MPA") %>% calculate_area_wTrash()
tb_2018 = tab3_pick_data(2018, type) %>% filter(stratum != "MPA") %>% calculate_area_wTrash()
plot =
bind_rows(
tb_2013 %>% mutate(year = 2013),
tb_2018 %>% mutate(year = 2018)
) %>%
mutate(year = as.factor(year)) %>%
ggplot(aes(x = stratum, y = p_area_trash, fill = year, group = year)) +
geom_col(position = 'dodge') +
geom_text(aes(label = p_label), position = position_dodge(0.9), vjust = -1, size = 3) +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
ggsci::scale_fill_jco() +
labs(
x = 'Stratum',
y = 'Relative Percent Trash Area'
)
return(plot)
}
tb_2013 = tab3_pick_data(2013, type) %>% filter(stratum != "MPA") %>% calculate_area_wTrash()
tb_2018 = tab3_pick_data(2018, type) %>% filter(stratum != "MPA") %>% calculate_area_wTrash()
plot =
bind_rows(
tb_2013 %>% mutate(year = 2013),
tb_2018 %>% mutate(year = 2018)
) %>%
mutate(year = as.factor(year)) %>%
ggplot(aes(x = stratum, y = p_area_trash, fill = year, group = year)) +
geom_col(position = 'dodge') +
geom_text(aes(label = p_label), position = position_dodge(0.9), vjust = -1, size = 3) +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_y_continuous(labels = scales::percent, limits = c(0,1)) +
ggsci::scale_fill_jco() +
labs(
x = 'Stratum',
y = 'Relative Percent Trash Area'
)
plot
tab3_compare_area_wTrash_plotter(input$tab3_Type)
tab3_compare_area_wTrash_plotter("Ocean")
runApp()
runApp()
runApp()
tb_2013 = group_by(data_2013, region) %>%
summarise(
count = sum(count),
area_weight = mean(area_weight),
average_count = count/area_weight)
region ="county"
tb_2013 = group_by(data_2013, region) %>%
summarise(
count = sum(count),
area_weight = mean(area_weight),
average_count = count/area_weight)
tb_2018 = group_by(data_2018, region) %>%
summarise(
count = sum(count),
area_weight = mean(area_weight),
average_count = count/area_weight)
groupBy = "county"
tb_2013 = group_by(data_2013, region) %>%
summarise(
count = sum(count),
area_weight = mean(area_weight),
average_count = count/area_weight)
data_2013
data_2013 = tab3_pick_data(2013, type) %>% filter(type != 'None' & stratum != "MPA")
data_2018 = tab3_pick_data(2018, type) %>% filter(type != 'None' & stratum != "MPA")
tb_2013 = group_by(data_2013, region)
tb_2013 = group_by(data_2013, region) %>%
summarise(
count = sum(count),
area_weight = mean(area_weight),
average_count = count/area_weight)
tb_2018 = group_by(data_2018, region) %>%
summarise(
count = sum(count),
area_weight = mean(area_weight),
average_count = count/area_weight)
plot =
bind_rows(
tb_2013 %>% filter(region %in% tb_2018$region) %>%mutate(year = 2013),
tb_2018 %>% filter(region %in% tb_2013$region) %>% mutate(year = 2018)
) %>%
mutate(year = as.factor(year)) %>%
ggplot() +
geom_col(aes(x = region, y = count, group = year, fill = year), position = 'dodge') +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ggsci::scale_fill_jco() +
labs(x = '', y = 'Total count', title = 'Total count of trash per county')
plot
runApp()
tb_2013 = group_by(data_2013, type) %>%
summarise(count = sum(count), area_weight = mean(area_weight), average_count = count/area_weight)
tb_2018 = group_by(data_2018, type) %>%
summarise(count = sum(count), area_weight = mean(area_weight), average_count = count/area_weight)
plot =
bind_rows(
tb_2013 %>% mutate(year = 2013),
tb_2018 %>% mutate(year = 2018)
) %>%
mutate(year = as.factor(year)) %>%
ggplot() +
geom_col(aes(x = type, y = count, group = year, fill = year), position = 'dodge') +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ggsci::scale_fill_jco() +
labs(x = '', y = 'Total count', title = 'Total count of trash per trash category')
plot
runApp()
tb_2013 = group_by(data_2013, type) %>%
summarise(count = sum(count), area_weight = mean(area_weight), average_count = count/area_weight)
tb_2018 = group_by(data_2018, type) %>%
summarise(count = sum(count), area_weight = mean(area_weight), average_count = count/area_weight)
plot =
bind_rows(
tb_2013 %>% mutate(year = 2013),
tb_2018 %>% mutate(year = 2018)
) %>%
mutate(year = as.factor(year)) %>%
ggplot() +
geom_col(aes(x = type, y = count, group = year, fill = year), position = 'dodge') +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ggsci::scale_fill_jco() +
labs(x = '', y = 'Total count', title = 'Total count of trash per trash category')
plot
tab3_compare_plotter(input$tab3_Type, "trashType")
tab3_compare_plotter <- function(type, groupBy){
data_2013 = tab3_pick_data(2013, type) %>% filter(type != 'None' & stratum != "MPA")
data_2018 = tab3_pick_data(2018, type) %>% filter(type != 'None' & stratum != "MPA")
if (groupBy == "stratum"){
tb_2013 = group_by(data_2013, stratum) %>% summarise(count = sum(count), area_weight = mean(area_weight), average_count = count/area_weight)
tb_2018 = group_by(data_2018, stratum) %>% summarise(count = sum(count), area_weight = mean(area_weight), average_count = count/area_weight)
plot =
bind_rows(
tb_2013 %>% mutate(year = 2013),
tb_2018 %>% mutate(year = 2018)
) %>%
mutate(year = as.factor(year)) %>%
ggplot() +
geom_col(aes(x = stratum, y = count, group = year, fill = year), position = 'dodge') +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ggsci::scale_fill_jco() +
labs(x = '', y = 'Total count', title = 'Total count of trash per stratum')
}
if (groupBy == "county"){
tb_2013 = group_by(data_2013, region) %>%
summarise(
count = sum(count),
area_weight = mean(area_weight),
average_count = count/area_weight)
tb_2018 = group_by(data_2018, region) %>%
summarise(
count = sum(count),
area_weight = mean(area_weight),
average_count = count/area_weight)
plot =
bind_rows(
tb_2013 %>% filter(region %in% tb_2018$region) %>%mutate(year = 2013),
tb_2018 %>% filter(region %in% tb_2013$region) %>% mutate(year = 2018)
) %>%
mutate(year = as.factor(year)) %>%
ggplot() +
geom_col(aes(x = region, y = count, group = year, fill = year), position = 'dodge') +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ggsci::scale_fill_jco() +
labs(x = '', y = 'Total count', title = 'Total count of trash per county')
}
if (groupBy == "trashType"){
tb_2013 = group_by(data_2013, type) %>%
summarise(count = sum(count), area_weight = mean(area_weight), average_count = count/area_weight)
tb_2018 = group_by(data_2018, type) %>%
summarise(count = sum(count), area_weight = mean(area_weight), average_count = count/area_weight)
plot =
bind_rows(
tb_2013 %>% mutate(year = 2013),
tb_2018 %>% mutate(year = 2018)
) %>%
mutate(year = as.factor(year)) %>%
ggplot() +
geom_col(aes(x = type, y = count, group = year, fill = year), position = 'dodge') +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
ggsci::scale_fill_jco() +
labs(x = '', y = 'Total count', title = 'Total count of trash per trash category')
}
return(plot)
}
tab3_compare_plotter("Ocean", "trashType")
runApp()
runApp()
